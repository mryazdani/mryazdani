<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
</head>
<body>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/browser-image-compression@1.0.15/dist/browser-image-compression.js"></script>  
  <input type="file" accept="image/*" onchange="handleImageUpload(event);">
  <input type="file" accept="image/*" onchange="HandleImg();">
  <img id="TestImg" src=""/>
  <a id="Down" href="">download</a>

  <script>
    async function HandleImg()
    {
      var ImageFile = event.target.files[0];
      document.getElementById('TestImg').src = URL.createObjectURL(await CompressImage(ImageFile));
    }

    async function CompressImage(ImageFile)
    {
      const options = {
        maxSizeMB: 1,
        maxWidthOrHeight: 500,
        useWebWorker: true
      }
      const compressedFile = await imageCompression(ImageFile, options);
      return compressedFile;
    }

    async function handleImageUpload(event) {

      const imageFile = event.target.files[0];
      console.log('originalFile instanceof Blob', imageFile instanceof Blob); // true
      console.log(`originalFile size ${imageFile.size / 1024 / 1024} MB`);

      const options = {
        maxSizeMB: 1,
        maxWidthOrHeight: 500,
        useWebWorker: true
      }
      try {
        const compressedFile = await imageCompression(imageFile, options);
        console.log('compressedFile instanceof Blob', compressedFile instanceof Blob); // true
        console.log(`compressedFile size ${compressedFile.size / 1024 / 1024} MB`); // smaller than maxSizeMB

         // write your own logic
         //alert(Base64.encode(compressedFile));
         document.getElementById('TestImg').src = URL.createObjectURL(compressedFile);
         document.getElementById('Down').href = URL.createObjectURL(compressedFile);
         document.getElementById('Down').download = imageFile.name;
      } catch (error) {
        console.log(error);
      }

      }
  </script>
</body>
</html>
